{% extends 'base.html' %}
{% block head %}
<title>Profile</title>
{% endblock %}
{% block body %}
<br/>

<div class="row" style="padding: 0px;">
    <div class="panel panel-green">
        <div class="panel-heading">            
            <span id="lbl_header">Hồ sơ</span>
        </div>
        <div class="panel-body">
            <div class="">
                <!-- <div class="" style="float: left;">
                    <center>
                        <div class="" style="float: left; margin: 0 0 10px 10px;">                
                            <span >Ảnh đại diện <i data-html="true" class="fa fa-question-circle" data-toggle="tooltip" title="Ảnh hiển thị khi tìm kiếm"></i></span></br>
                        
                            <div class="col-md-5" id="div_cropped">
                                <canvas id="canvas_thumbnail" width="256" height="256" style="border: 1px solid #007fc6; border-radius: 10px; max-width: 256px;">
                            </div>
                        </div>
                    </center>
                </div> -->

                <div class="">
                    
    
                    <div class="">
                        <div class="col-lg-2 col-md-2" style="max-width: 120px;">Email *</div>
                        <div class="">
                            <div class="form-group input-group">
                                <span class="input-group-addon"><i class="far fa-envelope"></i></span>
                                <input type="text" placeholder="Email" id='txt_email' class="form-control" disabled>
                            </div>
                        </div>
                    </div>

                    <div class="">
                        <div class="col-lg-2 col-md-2" style="max-width: 120px;">Điện thoại</div>
                        <div class="">
                            <div class="form-group input-group" >
                                <span class="input-group-addon"><i class="fa fa-phone"></i></span>
                                <input type="text" id='txt_phone' required class="form-control" onkeypress='AllowNumberOnly(event)' > 
                            </div>
                        </div>
                    </div>
    
                    <div class="">
                        <div class="col-lg-2 col-md-2" style="max-width: 120px;">Họ tên *</div>
                        <div class="">
                            <div class="form-group input-group">
                                <span class="input-group-addon"><i class="glyphicon glyphicon-user"></i></span>
                                <input type="text" placeholder="Họ tên *" id='txt_name' class="form-control" > 
                            </div>
                        </div>
                    </div>
    
    
                    <div class="">
                        <div class="col-lg-2 col-md-2" style="max-width: 120px;">Secret key</div>
                        <div class="">
                            <div class="form-group input-group">
                                <span class="input-group-addon"><i class="fa fa-key fa-fw"></i></span>
                                <input type="text" id='txt_secretkey' class="form-control" disabled>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            </br>
            <div class="row">
                <center>
                    <button type="submit" id ="btn_update" class="btn btn-success btn-default">
                        <i class="fa fa-save"></i> Cập nhật</button>
                </center>
            </div>
            
        </div>
    </div>
</div>

<!-- created modals -->
<div class="modal fade" id="modal_active" role="dialog">
    <div class="modal-dialog">
        <!-- Modal content-->
        <div class="modal-content panel-green">
            <div class="modal-header panel-heading">
                <button type="button" class="close" data-dismiss="modal">&times;</button>
                <h4 id="lbl_title">Nhập mã xác nhận</h4>
            </div>
            <div class="modal-body panel-body">            
                <div class="row">
                    <div class="col-md-12">
                        <label>Nhập mã xác nhận chúng tôi đã gửi vào số điện thoại của bạn</label>
                    </div>
                    
                    <div class="col-md-12">
                        <div id="div_phone" class="form-group input-group">
                            <span class="input-group-addon"><i class="fa fa-phone"></i></span>
                            <input type="text" placeholder="Số điện thoại" id='txt_phonePopup' class="form-control">
                        </div>                        
                    </div>
                    <div class="col-md-12">
                        <div class="form-group input-group">
                            <span class="input-group-addon"><i class="fa fa-key"></i></span>
                            <input type="text" placeholder="Nhập mã xác nhận" id='txt_activeNumber' class="form-control">
                        </div>                        
                    </div>
                    
                </div>            
                <button type="submit" id ="btn_active" class="btn btn-success btn-default pull-right">Kích hoạt tài khoản</button>
            </div> <!-- end modal body-->    
        </div>
    </div>
</div> 



<div class="modal fade" id="modal_crop_image" role="dialog">
    <div class="modal-dialog">
        <!-- Modal content-->
        <div class="modal-content panel-yellow">
            <div class="modal-header panel-heading">
                <button type="button" class="close" data-dismiss="modal">&times;</button>
                <h4 class="modal-title">Crop image</h4>
            </div>
            <div class="modal-body panel-body">
                <div class="">
                    <div class="row">
                    <div class="col-md-12">
                        <!-- <h3>Demo:</h3> -->
                        <div class="docs-demo">
                        <div class="img-container">
                            <img src="/static/cropper/picture.jpg" alt="Picture" class="cropper-hidden">
                        </div>
                        </div>
                    </div>
                
                    </div>
                    <div class="row" id="actions">
                    <div class="col-md-12 docs-buttons">
                        <!-- <h3>Toolbar:</h3> -->
                        <div class="btn-group">
                        <label class="btn btn-primary btn-upload" for="inputImage" title="Upload image file">
                            <input type="file" class="sr-only" id="inputImage" name="file" accept="image/*">                            
                            <span class="fa fa-upload"></span>                            
                        </label>
                        </div>
                
                        <div class="btn-group">
                            <button type="button" class="btn btn-primary" data-method="zoom" data-option="0.1" title="Zoom In">                            
                                <span class="fa fa-search-plus"></span>                            
                            </button>
                            <button type="button" class="btn btn-primary" data-method="zoom" data-option="-0.1" title="Zoom Out">                            
                                <span class="fa fa-search-minus"></span>                            
                            </button>
                        </div>
                
                        <div class="btn-group">
                            <button type="button" class="btn btn-primary" data-method="move" data-option="-10" data-second-option="0" title="Move Left">                            
                                <span class="fa fa-arrow-left"></span>                            
                            </button>
                            <button type="button" class="btn btn-primary" data-method="move" data-option="10" data-second-option="0" title="Move Right">                            
                                <span class="fa fa-arrow-right"></span>                            
                            </button>
                            <button type="button" class="btn btn-primary" data-method="move" data-option="0" data-second-option="-10" title="Move Up">                            
                                <span class="fa fa-arrow-up"></span>
                            </button>
                            <button type="button" class="btn btn-primary" data-method="move" data-option="0" data-second-option="10" title="Move Down">                            
                                <span class="fa fa-arrow-down"></span>                            
                            </button>
                        </div>
                
                        <div class="btn-group">
                        <button type="button" class="btn btn-primary" data-method="rotate" data-option="-90" title="Rotate Left">
                            <span class="docs-tooltip" data-toggle="tooltip" title="" data-original-title="cropper.rotate(-90)">
                            <span class="fa fa-undo-alt"></span>
                            </span>
                        </button>
                        <button type="button" class="btn btn-primary" data-method="rotate" data-option="90" title="Rotate Right">
                            <span class="docs-tooltip" data-toggle="tooltip" title="" data-original-title="cropper.rotate(90)">
                            <span class="fa fa-redo-alt"></span>
                            </span>
                        </button>
                        </div>
                
                        <div class="btn-group">
                        <button type="button" class="btn btn-primary" data-method="scaleX" data-option="-1" title="Flip Horizontal">                            
                            <span class="fa fa-arrows-alt-h"></span>                            
                        </button>
                        <button type="button" class="btn btn-primary" data-method="scaleY" data-option="-1" title="Flip Vertical">                            
                            <span class="fa fa-arrows-alt-v"></span>                            
                        </button>
                        </div>
                
                        <div class="btn-group btn-group-crop">
                            <button id="btn_crop" type="button" class="btn btn-success" data-method="getCroppedCanvas" >
                                <span class="fa fa-crop-alt"></span> Crop image
                            </button>
                        </div>
                       
                    </div>          
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>


<div class="modal fade" id="modal_confirm" role="dialog">
    <div class="modal-dialog">
        <!-- Modal content-->
        <div class="modal-content panel-green">
            <div class="modal-header panel-heading">
                <button type="button" class="close" data-dismiss="modal">&times;</button>
                <h4 id="lbl_title">Bạn có chắc chắn?</h4>
            </div>
            <div class="modal-body panel-body">            
                <div class="row">
                    <div class="col-md-12">
                        <label>Xóa tài khoản sẽ xóa tất cả dữ liệu của bạn, bao gồm thông tin tài khoản và lịch sử đóng tiền, sử dụng dịch vụ. 
                            Bạn có chắc chắn muốn xóa?
                        </label>
                    </div>                    
                </div>     
                </br>       
                <div class="row">
                    <div class="col-md-12">
                        <button type="submit" id ="btn_delete" class="btn btn-danger btn-default">
                            <i class="fas fa-trash-alt"></i> Xóa tài khoản</button>
    
                        <button type="submit" id ="btn_close" class="btn btn-success btn-default pull-right">
                            Không xóa nữa</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div> 

{% endblock %}

{% block scripts %}
<script>
g_jwt = null
canvasThumbnail = document.getElementById("canvas_thumbnail")

$(document).ready(function() {
    GetMyProfile()
});

$("#btn_update").click(function() {
    if($("#txt_phone").val() == "") 
    {
        showError("Chưa nhập số điện thoại")
        return
    }
    else
    {
        phone = $("#txt_phone").val()
    }

    if ($("#txt_name").val()=="")
    {
        showError("Chưa nhập họ tên")
        return
    }
    
    request_data = {
                    "phone": $("#txt_phone").val(),
                    "email": $("#txt_email").val(),
                    "fullname": $("#txt_name").val(),                    
                    "token": Cookies.get("token"),
                }
    host_request = gethost() + '/api/user/update'

    ajaxRequest("POST", host_request, request_data, onUpdateSuccess, genericFailCB)
});


function onUpdateSuccess(res) 
{        
    ShowToast("Cập nhật thành công")
}

function GetMyProfile()
{
    request_data = {
        "token" : Cookies.get("token")
    }
    host_request = gethost() + '/api/user/get'
    ajaxRequest("POST", host_request, request_data, onGetProfileSuccess, genericFailCB)  
}

function onGetProfileSuccess(res)
{     
    $("#txt_phone").val(res.phone)
    $("#txt_email").val(res.email)
    $("#txt_name").val(res.fullname)
    $("#cb_project").val(res.project_id)
    $("#txt_secretkey").val(res.secretkey)    
}


$("#div_cropped").click(function () {
    $("#inputImage").click()
})

function OnLoaded()
{
    $("#modal_crop_image").modal()
}

$("#btn_crop").click(function () {
    $("#modal_crop_image").modal("hide")  
})

function OnCropped()
{
    canvas = $("#div_cropped").children()[0]
    canvas = ResizeCanvas(canvas, 256, 256)
    $("#div_cropped").html(canvas)

    avatarBase64 = CanvasToBase64(canvas)
    request_data = {
        "phone" : $("#txt_phone").val(),
        "email": $("#txt_email").val(),
        "fullname": $("#txt_name").val(),
        "address": $("#txt_address").val(),
        "avatarBase64" : avatarBase64,
        "token": Cookies.get("token")
    }
    host_request = gethost() + '/api/user/update'
    ajaxRequest("POST", host_request, request_data, function(res){
        
    }, genericFailCB)
}

$("#btn_showConfirmModal").click(function () {
    $("#modal_confirm").modal()
})

$("#btn_close").click(function () {
    $("#modal_confirm").modal("hide")
})

$("#btn_delete").click(function () {
    request_data = {
        "token": Cookies.get("token")
    }
    host_request = gethost() + '/api/user/delete'
    ajaxRequest("POST", host_request, request_data, function(res){
        $("#modal_confirm").modal("hide")
        location.href = "/"
    }, genericFailCB)    
})

</script>

{% endblock %}